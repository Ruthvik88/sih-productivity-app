{% extends "base.html" %}

{% block body_content %}
<div class="layout-grid">
    <aside class="sidebar">
        <div class="sidebar-header">
            <h3>GovFlow</h3>
            <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Close sidebar">&times;</button>
        </div>
        <ul>
            <!-- Logic for active link based on role -->
            {% if user.role == 'Administrator' %}
            <li><a href="{{ url_for('organization') }}">Organizational View</a></li>
            {% else %}
            <li><a href="{{ url_for('dashboard') }}">My Dashboard</a></li>
            <li><a href="{{ url_for('profile') }}">Profile</a></li>
            {% endif %}
            
            {% if user.role in ['Manager', 'Administrator'] %}
            <li><a href="{{ url_for('create_goal') }}" class="active">Assign Goal</a></li>
            {% endif %}
        </ul>
        <footer>
            <small>Logged in as: {{ user.full_name }}</small>
        </footer>
    </aside>

    <main class="main-content">
        <header class="main-header">
            <h1>Assign a New Goal</h1>
            <a href="{{ url_for('logout') }}" role="button" class="secondary outline">Log Out</a>
        </header>
        <article>
            <form method="post" novalidate>
                <label for="title">Goal Title</label>
                <input type="text" id="title" name="title" placeholder="e.g., Finalize Q3 budget report" required>

                <label for="description">Description</label>
                <textarea id="description" name="description" placeholder="Provide more details about the goal..."></textarea>
                
                <hr>
                
                <div class="grid">
                    <div>
                        <label for="kpi_name">KPI Name</label>
                        <input type="text" id="kpi_name" name="kpi_name" placeholder="e.g., Reports Submitted" required>
                    </div>
                    <div>
                        <label for="target_value">Target Value</label>
                        <input type="number" id="target_value" name="target_value" value="100" required>
                    </div>
                    <div>
                        <label for="weight">Importance Weight (1-10)</label>
                        <input type="number" id="weight" name="weight" min="1" max="10" value="5" required>
                    </div>
                </div>
                
                <hr>

                <!-- MODIFIED: This dropdown now shows managers for admins or employees for managers -->
                <label for="assignee">Assign To</label>
                <select id="assignee" name="assignee" required>
                    {% if user.role == 'Administrator' %}
                        <option value="" disabled selected>Select a manager...</option>
                    {% else %}
                        <option value="" disabled selected>Select an employee...</option>
                    {% endif %}

                    {% for person in assignees %}
                        <option value="{{ person.id }}">{{ person.full_name }}</option>
                    {% endfor %}
                </select>

                <button type="submit">Create and Assign Goal</button>
            </form>
        </article>
    </main>
</div>
{% endblock %}

